# 🔮 八字命理基础知识

> 本文档为项目开发参考，介绍八字命理的核心概念和计算规则。

---

## 一、天干地支基础

### 1.1 十天干

| 序号 | 天干 | 五行 | 阴阳 |
|------|------|------|------|
| 1 | 甲 | 木 | 阳 |
| 2 | 乙 | 木 | 阴 |
| 3 | 丙 | 火 | 阳 |
| 4 | 丁 | 火 | 阴 |
| 5 | 戊 | 土 | 阳 |
| 6 | 己 | 土 | 阴 |
| 7 | 庚 | 金 | 阳 |
| 8 | 辛 | 金 | 阴 |
| 9 | 壬 | 水 | 阳 |
| 10 | 癸 | 水 | 阴 |

### 1.2 十二地支

| 序号 | 地支 | 五行 | 阴阳 | 对应时辰 | 生肖 |
|------|------|------|------|----------|------|
| 1 | 子 | 水 | 阳 | 23:00-01:00 | 鼠 |
| 2 | 丑 | 土 | 阴 | 01:00-03:00 | 牛 |
| 3 | 寅 | 木 | 阳 | 03:00-05:00 | 虎 |
| 4 | 卯 | 木 | 阴 | 05:00-07:00 | 兔 |
| 5 | 辰 | 土 | 阳 | 07:00-09:00 | 龙 |
| 6 | 巳 | 火 | 阴 | 09:00-11:00 | 蛇 |
| 7 | 午 | 火 | 阳 | 11:00-13:00 | 马 |
| 8 | 未 | 土 | 阴 | 13:00-15:00 | 羊 |
| 9 | 申 | 金 | 阳 | 15:00-17:00 | 猴 |
| 10 | 酉 | 金 | 阴 | 17:00-19:00 | 鸡 |
| 11 | 戌 | 土 | 阳 | 19:00-21:00 | 狗 |
| 12 | 亥 | 水 | 阴 | 21:00-23:00 | 猪 |

### 1.3 六十甲子

天干地支两两相配，形成六十个组合，循环往复。

```
甲子 乙丑 丙寅 丁卯 戊辰 己巳 庚午 辛未 壬申 癸酉
甲戌 乙亥 丙子 丁丑 戊寅 己卯 庚辰 辛巳 壬午 癸未
甲申 乙酉 丙戌 丁亥 戊子 己丑 庚寅 辛卯 壬辰 癸巳
甲午 乙未 丙申 丁酉 戊戌 己亥 庚子 辛丑 壬寅 癸卯
甲辰 乙巳 丙午 丁未 戊申 己酉 庚戌 辛亥 壬子 癸丑
甲寅 乙卯 丙辰 丁巳 戊午 己未 庚申 辛酉 壬戌 癸亥
```

---

## 二、地支藏干

每个地支内部藏有天干，分为本气、中气、余气：

| 地支 | 本气 | 中气 | 余气 |
|------|------|------|------|
| 子 | 癸 | - | - |
| 丑 | 己 | 癸 | 辛 |
| 寅 | 甲 | 丙 | 戊 |
| 卯 | 乙 | - | - |
| 辰 | 戊 | 乙 | 癸 |
| 巳 | 丙 | 庚 | 戊 |
| 午 | 丁 | 己 | - |
| 未 | 己 | 丁 | 乙 |
| 申 | 庚 | 壬 | 戊 |
| 酉 | 辛 | - | - |
| 戌 | 戊 | 辛 | 丁 |
| 亥 | 壬 | 甲 | - |

---

## 三、五行生克

### 3.1 五行相生
```
木 → 火 → 土 → 金 → 水 → 木（循环）
木生火，火生土，土生金，金生水，水生木
```

### 3.2 五行相克
```
木 → 土 → 水 → 火 → 金 → 木（循环）
木克土，土克水，水克火，火克金，金克木
```

### 3.3 五行对应

| 五行 | 方位 | 颜色 | 季节 | 脏腑 | 数字 |
|------|------|------|------|------|------|
| 木 | 东 | 青/绿 | 春 | 肝胆 | 3, 8 |
| 火 | 南 | 红 | 夏 | 心/小肠 | 2, 7 |
| 土 | 中 | 黄 | 四季末 | 脾胃 | 5, 0 |
| 金 | 西 | 白 | 秋 | 肺/大肠 | 4, 9 |
| 水 | 北 | 黑/蓝 | 冬 | 肾/膀胱 | 1, 6 |

---

## 四、十神体系

以日干（日主）为中心，其他干支与日干的五行生克关系决定十神：

### 4.1 十神定义

| 十神 | 关系 | 阴阳 | 六亲（男命） | 六亲（女命） |
|------|------|------|--------------|--------------|
| 比肩 | 同我者 | 同性 | 兄弟 | 姐妹 |
| 劫财 | 同我者 | 异性 | 姐妹 | 兄弟 |
| 食神 | 我生者 | 同性 | 女儿 | 儿子 |
| 伤官 | 我生者 | 异性 | 儿子 | 女儿 |
| 偏财 | 我克者 | 同性 | 父亲/情人 | 父亲 |
| 正财 | 我克者 | 异性 | 妻子 | - |
| 七杀 | 克我者 | 同性 | 儿子 | 丈夫 |
| 正官 | 克我者 | 异性 | 女儿 | 丈夫 |
| 偏印 | 生我者 | 同性 | 继母 | 继母 |
| 正印 | 生我者 | 异性 | 母亲 | 母亲 |

### 4.2 十神速查表

以日干为行，其他干为列：

| 日干↓ 他干→ | 甲 | 乙 | 丙 | 丁 | 戊 | 己 | 庚 | 辛 | 壬 | 癸 |
|-------------|----|----|----|----|----|----|----|----|----|----|
| 甲 | 比肩 | 劫财 | 食神 | 伤官 | 偏财 | 正财 | 七杀 | 正官 | 偏印 | 正印 |
| 乙 | 劫财 | 比肩 | 伤官 | 食神 | 正财 | 偏财 | 正官 | 七杀 | 正印 | 偏印 |
| 丙 | 偏印 | 正印 | 比肩 | 劫财 | 食神 | 伤官 | 偏财 | 正财 | 七杀 | 正官 |
| 丁 | 正印 | 偏印 | 劫财 | 比肩 | 伤官 | 食神 | 正财 | 偏财 | 正官 | 七杀 |
| 戊 | 七杀 | 正官 | 偏印 | 正印 | 比肩 | 劫财 | 食神 | 伤官 | 偏财 | 正财 |
| 己 | 正官 | 七杀 | 正印 | 偏印 | 劫财 | 比肩 | 伤官 | 食神 | 正财 | 偏财 |
| 庚 | 偏财 | 正财 | 七杀 | 正官 | 偏印 | 正印 | 比肩 | 劫财 | 食神 | 伤官 |
| 辛 | 正财 | 偏财 | 正官 | 七杀 | 正印 | 偏印 | 劫财 | 比肩 | 伤官 | 食神 |
| 壬 | 食神 | 伤官 | 偏财 | 正财 | 七杀 | 正官 | 偏印 | 正印 | 比肩 | 劫财 |
| 癸 | 伤官 | 食神 | 正财 | 偏财 | 正官 | 七杀 | 正印 | 偏印 | 劫财 | 比肩 |

---

## 五、四柱排盘规则

### 5.1 年柱

- 以**立春**为界，立春前属上一年
- 干支纪年法，从甲子年开始循环

**计算公式**（近似）：
```javascript
// 年份对应天干（仅适用于立春后）
const tianGanIndex = (year - 4) % 10;
// 年份对应地支
const diZhiIndex = (year - 4) % 12;
```

### 5.2 月柱

- 以**节气**为界，不是农历初一
- 十二节气对应十二月

| 月份 | 节气（交节） | 地支 | 月建 |
|------|--------------|------|------|
| 正月 | 立春 | 寅 | 建寅 |
| 二月 | 惊蛰 | 卯 | 建卯 |
| 三月 | 清明 | 辰 | 建辰 |
| 四月 | 立夏 | 巳 | 建巳 |
| 五月 | 芒种 | 午 | 建午 |
| 六月 | 小暑 | 未 | 建未 |
| 七月 | 立秋 | 申 | 建申 |
| 八月 | 白露 | 酉 | 建酉 |
| 九月 | 寒露 | 戌 | 建戌 |
| 十月 | 立冬 | 亥 | 建亥 |
| 十一月 | 大雪 | 子 | 建子 |
| 十二月 | 小寒 | 丑 | 建丑 |

**月干推算口诀**：
```
甲己之年丙作首，乙庚之年戊为头，
丙辛之年庚寅始，丁壬壬寅顺行流，
戊癸之年甲寅起，正月建寅顺行走。
```

| 年干 | 正月(寅月)干 |
|------|--------------|
| 甲、己 | 丙 |
| 乙、庚 | 戊 |
| 丙、辛 | 庚 |
| 丁、壬 | 壬 |
| 戊、癸 | 甲 |

### 5.3 日柱

- 需要使用万年历查询
- 或使用蔡勒公式计算

**计算参考**：使用 `lunar-javascript` 库直接获取

### 5.4 时柱

- 以地方真太阳时为准
- 子时（23:00-01:00）需判断早晚子时

**时干推算口诀**：
```
甲己还加甲，乙庚丙作初，
丙辛从戊起，丁壬庚子居，
戊癸何方发，壬子是真途。
```

| 日干 | 子时干 |
|------|--------|
| 甲、己 | 甲 |
| 乙、庚 | 丙 |
| 丙、辛 | 戊 |
| 丁、壬 | 庚 |
| 戊、癸 | 壬 |

---

## 六、大运排盘

### 6.1 起运年龄

根据出生日到最近节气的天数计算：
- 男命阳年、女命阴年：顺数到下一个节气
- 男命阴年、女命阳年：逆数到上一个节气

**计算公式**：
```
起运年龄 = 天数 ÷ 3（四舍五入）
```

### 6.2 大运方向

| 性别 | 年干阴阳 | 大运方向 |
|------|----------|----------|
| 男 | 阳年 | 顺行 |
| 男 | 阴年 | 逆行 |
| 女 | 阳年 | 逆行 |
| 女 | 阴年 | 顺行 |

### 6.3 大运排列

- 从月柱出发
- 顺行：按六十甲子顺序往后
- 逆行：按六十甲子顺序往前
- 每步大运管 10 年

---

## 七、常用神煞

| 神煞 | 查法 | 吉凶 | 含义 |
|------|------|------|------|
| 天乙贵人 | 日干查 | 吉 | 贵人相助 |
| 文昌 | 日干查 | 吉 | 利学业 |
| 驿马 | 日支查 | 中 | 主奔波 |
| 桃花 | 日支查 | 中 | 主情缘 |
| 华盖 | 日支查 | 中 | 主孤独 |
| 将星 | 日支查 | 吉 | 主权力 |
| 羊刃 | 日干查 | 凶 | 主刚烈 |
| 亡神 | 日支查 | 凶 | 主损失 |
| 劫煞 | 日支查 | 凶 | 主劫难 |

**天乙贵人查法**：
```
甲戊见牛羊，乙己鼠猴乡，
丙丁猪鸡位，壬癸兔蛇藏，
庚辛逢马虎，此是贵人方。
```

---

## 八、代码实现参考

### 8.1 天干地支常量

```typescript
export const TIAN_GAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'] as const;
export const DI_ZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'] as const;

export const TIAN_GAN_WUXING: Record<string, string> = {
  '甲': '木', '乙': '木',
  '丙': '火', '丁': '火',
  '戊': '土', '己': '土',
  '庚': '金', '辛': '金',
  '壬': '水', '癸': '水',
};

export const DI_ZHI_WUXING: Record<string, string> = {
  '子': '水', '丑': '土', '寅': '木', '卯': '木',
  '辰': '土', '巳': '火', '午': '火', '未': '土',
  '申': '金', '酉': '金', '戌': '土', '亥': '水',
};
```

### 8.2 地支藏干

```typescript
export const CANG_GAN: Record<string, string[]> = {
  '子': ['癸'],
  '丑': ['己', '癸', '辛'],
  '寅': ['甲', '丙', '戊'],
  '卯': ['乙'],
  '辰': ['戊', '乙', '癸'],
  '巳': ['丙', '庚', '戊'],
  '午': ['丁', '己'],
  '未': ['己', '丁', '乙'],
  '申': ['庚', '壬', '戊'],
  '酉': ['辛'],
  '戌': ['戊', '辛', '丁'],
  '亥': ['壬', '甲'],
};
```

### 8.3 十神计算

```typescript
export function getShiShen(dayGan: string, targetGan: string): string {
  const ganOrder = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
  const dayIndex = ganOrder.indexOf(dayGan);
  const targetIndex = ganOrder.indexOf(targetGan);
  
  if (dayIndex === -1 || targetIndex === -1) return '';
  
  const dayWuxing = Math.floor(dayIndex / 2); // 0木 1火 2土 3金 4水
  const targetWuxing = Math.floor(targetIndex / 2);
  const daySameParity = dayIndex % 2 === targetIndex % 2; // 同阴阳
  
  // 计算五行关系
  const diff = (targetWuxing - dayWuxing + 5) % 5;
  
  const shiShenMap: Record<number, [string, string]> = {
    0: ['比肩', '劫财'],      // 同我
    1: ['食神', '伤官'],      // 我生
    2: ['偏财', '正财'],      // 我克
    3: ['七杀', '正官'],      // 克我
    4: ['偏印', '正印'],      // 生我
  };
  
  return daySameParity ? shiShenMap[diff][0] : shiShenMap[diff][1];
}
```

---

## 九、推荐库

### lunar-javascript

```bash
npm install lunar-javascript
```

```typescript
import { Solar, Lunar, EightChar } from 'lunar-javascript';

// 阳历转八字
const solar = Solar.fromYmd(1990, 1, 15);
const lunar = solar.getLunar();
const bazi = lunar.getEightChar();

console.log(bazi.getYear());   // 年柱
console.log(bazi.getMonth());  // 月柱
console.log(bazi.getDay());    // 日柱
console.log(bazi.getTime());   // 时柱

// 获取大运
const yun = bazi.getYun(1);  // 1=男，0=女
const daYunList = yun.getDaYun();
```

---

> 📚 **参考文献**：《子平真诠》《穷通宝鉴》《滴天髓》《三命通会》

