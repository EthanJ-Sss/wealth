# 🔮 专业八字命理项目 - 开发 TODO 清单

> **目标**：将现有的"人生K线"项目从娱乐风格改造成专业的八字命理分析系统，保持现有的交互流程不变，着重优化分析内容的专业性。

---

## 📋 项目改造概览

### 保持不变的部分 ✅
- ✅ 用户手动输入四柱干支和大运信息
- ✅ 复制提示词到外部 AI（ChatGPT、Claude、Gemini 等）
- ✅ 粘贴 AI 返回的 JSON 数据
- ✅ K 线图表展示功能
- ✅ JSON 数据导入/导出

### 需要调整的部分 🔄
- 🔄 移除币圈/Web3 相关娱乐内容
- 🔄 添加专业命理分析维度（格局、用神、神煞等）
- 🔄 优化 AI 提示词，更专业化
- 🔄 调整分析报告卡片展示
- 🔄 更新界面文案和品牌定位

---

## 🗂️ 模块划分与任务清单

### 一、数据结构调整 📊 `[优先级: P0 - 核心]`

**文件**: `types.ts`

| 任务 | 描述 | 状态 |
|------|------|------|
| 1.1 | 移除 `AnalysisData` 中的 `crypto` 字段 | ⬜ 待开发 |
| 1.2 | 移除 `AnalysisData` 中的 `cryptoScore` 字段 | ⬜ 待开发 |
| 1.3 | 移除 `AnalysisData` 中的 `cryptoYear` 字段 | ⬜ 待开发 |
| 1.4 | 移除 `AnalysisData` 中的 `cryptoStyle` 字段 | ⬜ 待开发 |
| 1.5 | 添加 `geJu` 格局分析字段 | ⬜ 待开发 |
| 1.6 | 添加 `geJuScore` 格局评分字段 | ⬜ 待开发 |
| 1.7 | 添加 `yongShen` 用神分析字段 | ⬜ 待开发 |
| 1.8 | 添加 `yongShenScore` 用神评分字段 | ⬜ 待开发 |
| 1.9 | 添加 `shenSha` 神煞分析字段 | ⬜ 待开发 |
| 1.10 | 添加 `shenShaScore` 神煞评分字段 | ⬜ 待开发 |
| 1.11 | 添加 `liuNian` 近十年流年分析字段 | ⬜ 待开发 |
| 1.12 | 添加 `kaiYun` 开运建议字段 | ⬜ 待开发 |

**修改前后对比**：

```typescript
// ========== 移除的字段 ==========
// crypto: string;       // ❌ 币圈交易分析
// cryptoScore: number;  // ❌ 投机运势评分
// cryptoYear: string;   // ❌ 暴富流年
// cryptoStyle: string;  // ❌ 适合流派

// ========== 新增的字段 ==========
export interface AnalysisData {
  // ... 保留原有字段 ...
  
  // 新增专业命理分析字段
  geJu: string;           // 格局分析（如：正官格、七杀格、食神格等）
  geJuScore: number;      // 格局评分 0-10
  
  yongShen: string;       // 用神忌神分析（喜用五行、忌讳五行）
  yongShenScore: number;  // 用神评分 0-10
  
  shenSha: string;        // 神煞分析（天乙贵人、文昌、驿马、桃花等）
  shenShaScore: number;   // 神煞评分 0-10
  
  liuNian: string;        // 近十年流年运势概述
  liuNianScore: number;   // 流年评分 0-10
  
  kaiYun: string;         // 开运建议（颜色、方位、行业、佩戴等）
  kaiYunScore: number;    // 开运评分 0-10
}
```

---

### 二、提示词优化 📝 `[优先级: P0 - 核心]`

**文件**: `constants.ts`

| 任务 | 描述 | 状态 |
|------|------|------|
| 2.1 | 移除系统提示词中的币圈相关内容 | ⬜ 待开发 |
| 2.2 | 添加格局分析要求 | ⬜ 待开发 |
| 2.3 | 添加用神忌神分析要求 | ⬜ 待开发 |
| 2.4 | 添加神煞分析要求 | ⬜ 待开发 |
| 2.5 | 添加开运建议要求 | ⬜ 待开发 |
| 2.6 | 更新 JSON 输出格式示例 | ⬜ 待开发 |
| 2.7 | 优化流年批断专业性 | ⬜ 待开发 |

**新版系统提示词**：

```typescript
export const BAZI_SYSTEM_INSTRUCTION = `
你是一位专业的八字命理分析师，精通子平八字命理学。根据用户提供的四柱干支和大运信息，生成"人生K线图"数据和命理报告。

**核心规则:**
1. **年龄计算**: 采用虚岁，从 1 岁开始。
2. **K线详批**: 每年的 \`reason\` 字段必须**控制在20-30字以内**，简洁描述吉凶趋势。
3. **评分机制**: 所有维度给出 0-10 分。
4. **数据起伏**: 让评分呈现明显波动，体现"牛市"和"熊市"区别，禁止输出平滑直线。

**大运规则:**
- 顺行: 甲子 -> 乙丑 -> 丙寅...
- 逆行: 甲子 -> 癸亥 -> 壬戌...
- 以用户指定的第一步大运为起点，每步管10年。

**专业分析要求:**

1. **格局分析 (geJu)**
   - 判断命局格局类型（正官格、七杀格、正财格、偏财格、食神格、伤官格、正印格、偏印格等）
   - 分析格局的成败与高低
   - 说明格局对人生的主要影响

2. **用神忌神分析 (yongShen)**
   - 判断日主强弱
   - 确定命局喜用五行
   - 指出忌讳五行
   - 说明用神对运势的影响

3. **神煞分析 (shenSha)**
   - 查明命中主要神煞（天乙贵人、文昌、驿马、桃花、华盖、将星、羊刃等）
   - 解释各神煞的吉凶含义
   - 说明神煞在不同柱位的表现

4. **开运建议 (kaiYun)**
   - 喜用颜色
   - 有利方位
   - 适宜行业
   - 佩戴建议
   - 风水调理

**关键字段:**
- \`daYun\`: 大运干支 (10年不变)
- \`ganZhi\`: 流年干支 (每年一变)

**输出JSON结构:**

{
  "bazi": ["年柱", "月柱", "日柱", "时柱"],
  "summary": "命理总评（100字）",
  "summaryScore": 8,
  "personality": "性格分析（80字）",
  "personalityScore": 8,
  "geJu": "格局分析：判断格局类型及成败（80字）",
  "geJuScore": 7,
  "yongShen": "用神忌神：日主强弱、喜用五行、忌讳五行（80字）",
  "yongShenScore": 7,
  "shenSha": "神煞分析：命中神煞及其吉凶含义（80字）",
  "shenShaScore": 6,
  "industry": "事业分析（80字）",
  "industryScore": 7,
  "fengShui": "风水建议：方位、地理环境、开运建议（80字）",
  "fengShuiScore": 8,
  "wealth": "财富分析（80字）",
  "wealthScore": 9,
  "marriage": "婚姻分析（80字）",
  "marriageScore": 6,
  "health": "健康分析（60字）",
  "healthScore": 5,
  "family": "六亲分析（60字）",
  "familyScore": 7,
  "liuNian": "近十年流年运势概述（100字）",
  "liuNianScore": 7,
  "kaiYun": "开运建议：颜色、方位、行业、佩戴、风水（80字）",
  "kaiYunScore": 8,
  "chartPoints": [
    {"age":1,"year":1990,"daYun":"童限","ganZhi":"庚午","open":50,"close":55,"high":60,"low":45,"score":55,"reason":"开局平稳，家庭呵护"},
    ... (共100条，reason控制在20-30字)
  ]
}

**流年批断要点:**
- 结合当年流年干支与命局的生克关系
- 考虑大运对流年的影响
- 参考神煞的流年表现
- 吉凶判断要有理有据
`;
```

---

### 三、分析报告组件调整 🎨 `[优先级: P0 - 核心]`

**文件**: `components/AnalysisResult.tsx`

| 任务 | 描述 | 状态 |
|------|------|------|
| 3.1 | 移除"币圈交易运势"卡片 | ⬜ 待开发 |
| 3.2 | 添加"格局分析"卡片 | ⬜ 待开发 |
| 3.3 | 添加"用神忌神"卡片 | ⬜ 待开发 |
| 3.4 | 添加"神煞解读"卡片 | ⬜ 待开发 |
| 3.5 | 添加"近十年运势"卡片 | ⬜ 待开发 |
| 3.6 | 添加"开运建议"卡片 | ⬜ 待开发 |
| 3.7 | 调整卡片排列顺序 | ⬜ 待开发 |
| 3.8 | 更新评分讲解内容 | ⬜ 待开发 |
| 3.9 | 选择合适的图标 | ⬜ 待开发 |

**卡片调整对比**：

| 移除的卡片 | 新增的卡片 |
|------------|------------|
| ❌ 币圈交易运势 (Bitcoin 图标) | ✅ 格局分析 (Layers 图标) |
| | ✅ 用神忌神 (Target 图标) |
| | ✅ 神煞解读 (Sparkles 图标) |
| | ✅ 近十年运势 (TrendingUp 图标) |
| | ✅ 开运建议 (Lightbulb 图标) |

**建议的卡片排列顺序**：
1. 格局分析
2. 用神忌神
3. 性格分析
4. 事业行业
5. 财富层级
6. 婚姻情感
7. 身体健康
8. 六亲关系
9. 神煞解读
10. 发展风水
11. 近十年运势
12. 开运建议
13. 评分讲解

---

### 四、数据导入组件调整 📥 `[优先级: P1 - 重要]`

**文件**: `components/ImportDataMode.tsx`

| 任务 | 描述 | 状态 |
|------|------|------|
| 4.1 | 更新用户提示词生成函数，移除币圈相关 | ⬜ 待开发 |
| 4.2 | 更新 JSON 解析，适配新字段 | ⬜ 待开发 |
| 4.3 | 添加新字段的默认值处理 | ⬜ 待开发 |

**修改 `generateUserPrompt` 函数**：
- 移除币圈分析要求
- 添加格局、用神、神煞等专业分析要求

**修改 `handleImport` 函数**：
- 解析新增的 `geJu`, `yongShen`, `shenSha`, `liuNian`, `kaiYun` 字段
- 提供合理的默认值

---

### 五、主应用组件调整 🏠 `[优先级: P1 - 重要]`

**文件**: `App.tsx`

| 任务 | 描述 | 状态 |
|------|------|------|
| 5.1 | 更新 `handleDataImport` 适配新数据结构 | ⬜ 待开发 |
| 5.2 | 更新 `handleExportJson` 导出新字段 | ⬜ 待开发 |
| 5.3 | 更新 `handleImportJsonFile` 解析新字段 | ⬜ 待开发 |
| 5.4 | 更新 `handleSaveHtml` 包含新分析内容 | ⬜ 待开发 |
| 5.5 | 更新打印表格包含新内容 | ⬜ 待开发 |

---

### 六、界面文案更新 📝 `[优先级: P1 - 重要]`

**涉及文件**: `App.tsx`, `index.html`, `components/*.tsx`

| 任务 | 描述 | 涉及文件 | 状态 |
|------|------|----------|------|
| 6.1 | 更新网站标题（可选：更专业的名称） | `index.html` | ⬜ 待开发 |
| 6.2 | 更新首页介绍文案，突出专业性 | `App.tsx` | ⬜ 待开发 |
| 6.3 | 更新使用说明文案 | `App.tsx` | ⬜ 待开发 |
| 6.4 | 更新页脚免责声明 | `App.tsx` | ⬜ 待开发 |
| 6.5 | 移除 AI 支持列表中的"币圈"相关描述 | 相关组件 | ⬜ 待开发 |

**文案调整示例**：

```tsx
// 首页标题 - 可以保持或微调
<h2>洞悉命运起伏，预见人生轨迹</h2>

// 首页介绍 - 更专业的描述
<p>
  结合<strong>传统子平八字命理</strong>与<strong>金融可视化技术</strong>，
  将您的一生运势绘制成类似股票行情的K线图，直观展现人生的起伏变化。
</p>

// 功能特点 - 移除币圈，添加专业内容
<ul>
  <li>📊 可视化运势：用K线图展示1-100岁的人生运势</li>
  <li>🎯 格局分析：判断命局格局类型及成败</li>
  <li>⚖️ 用神忌神：分析日主强弱与喜忌五行</li>
  <li>✨ 神煞解读：详解命中神煞及其影响</li>
  <li>🔮 开运建议：颜色、方位、行业等全方位指导</li>
</ul>

// 免责声明 - 更正式的措辞
<p>
  免责声明：本系统基于传统八字命理学理论，仅供文化研究与个人参考。
  命运掌握在自己手中，请理性看待分析结果，切勿过度依赖。
</p>
```

---

### 七、评分讲解更新 📖 `[优先级: P2 - 次要]`

**文件**: `components/AnalysisResult.tsx` 中的评分讲解卡片

| 任务 | 描述 | 状态 |
|------|------|------|
| 7.1 | 更新评分说明文案 | ⬜ 待开发 |
| 7.2 | 添加命理相关的补充说明 | ⬜ 待开发 |

**更新后的评分讲解**：

```tsx
<p className="text-xs text-black leading-relaxed">
  注：八字命理是一门古老的预测学，通过分析出生时间的天干地支组合，
  推断人生运势趋势。评分仅供参考，实际人生受多重因素影响。
  古语云："一命二运三风水，四积阴德五读书，六名七相八敬神，九交贵人十养生。"
  命理分析旨在帮助我们了解自身特点，做出更好的人生选择。
</p>
```

---

## 📁 涉及修改的文件清单

```
lifekline-main/
├── types.ts                      # ✏️ 修改：移除币圈字段，添加专业字段
├── constants.ts                  # ✏️ 修改：重写系统提示词
├── App.tsx                       # ✏️ 修改：适配新数据结构，更新文案
├── index.html                    # ✏️ 修改：更新网站标题（可选）
├── components/
│   ├── AnalysisResult.tsx        # ✏️ 修改：移除币圈卡片，添加专业卡片
│   └── ImportDataMode.tsx        # ✏️ 修改：更新提示词和解析逻辑
└── services/
    └── geminiService.ts          # ✏️ 修改：适配新数据结构（如果使用）
```

---

## 🚀 开发步骤建议

### Step 1：修改类型定义 `types.ts`
```typescript
// 1. 移除币圈相关字段
// 2. 添加新的专业分析字段
```

### Step 2：更新系统提示词 `constants.ts`
```typescript
// 1. 重写 BAZI_SYSTEM_INSTRUCTION
// 2. 移除币圈分析逻辑
// 3. 添加格局、用神、神煞等分析要求
```

### Step 3：修改分析报告组件 `AnalysisResult.tsx`
```typescript
// 1. 移除币圈卡片
// 2. 添加新的专业分析卡片
// 3. 调整卡片排列顺序
```

### Step 4：修改数据导入组件 `ImportDataMode.tsx`
```typescript
// 1. 更新用户提示词生成
// 2. 更新 JSON 解析逻辑
```

### Step 5：修改主应用 `App.tsx`
```typescript
// 1. 适配新数据结构
// 2. 更新导入导出逻辑
// 3. 更新界面文案
```

### Step 6：测试与调整
```bash
# 1. 启动开发服务器
npm run dev

# 2. 测试完整流程
# 3. 调整样式和文案
```

---

## ✅ 完成检查清单

### 功能检查
- [ ] 币圈相关内容已完全移除
- [ ] 新增的专业分析字段正常显示
- [ ] 提示词生成包含新的分析要求
- [ ] JSON 导入导出正常工作
- [ ] K 线图正常显示
- [ ] 所有卡片正常渲染

### 内容检查
- [ ] 没有遗留的"币圈"、"加密货币"等字眼
- [ ] 专业术语使用正确（格局、用神、神煞等）
- [ ] 评分讲解内容已更新
- [ ] 免责声明措辞专业

### 样式检查
- [ ] 新卡片样式与整体风格一致
- [ ] 图标选择合适
- [ ] 颜色搭配协调
- [ ] 移动端适配正常

---

## 📝 开发日志

| 日期 | 进展 | 备注 |
|------|------|------|
| 2024-12-23 | 项目分析与规划 | 创建 TODO 文档，明确改造范围 |
| 2024-12-23 | ✅ 完成全部改造 | 移除币圈内容，添加专业命理分析 |

### 已完成的修改：
1. ✅ `types.ts` - 移除 crypto 相关字段，添加 geJu、yongShen、shenSha、liuNian、kaiYun 字段
2. ✅ `constants.ts` - 重写系统提示词，添加专业命理分析要求
3. ✅ `components/AnalysisResult.tsx` - 移除币圈卡片，添加格局、用神、神煞、流年、开运建议卡片
4. ✅ `components/ImportDataMode.tsx` - 更新提示词生成和 JSON 解析逻辑
5. ✅ `App.tsx` - 更新导入导出逻辑，适配新数据结构
6. ✅ `services/geminiService.ts` - 同步更新解析逻辑

---

## ⚠️ 注意事项

1. **向后兼容**：确保旧版 JSON 数据仍可导入（缺失字段使用默认值）
2. **提示词测试**：新提示词需在多个 AI 平台测试，确保输出格式正确
3. **免责声明**：保持免责声明，明确仅供参考
4. **术语准确**：使用正确的命理术语，避免误导用户

---

## 📚 命理术语参考

### 八大格局
| 格局 | 取用条件 |
|------|----------|
| 正官格 | 月令透正官，官星有力 |
| 七杀格 | 月令透七杀，杀星有力 |
| 正财格 | 月令透正财，财星有力 |
| 偏财格 | 月令透偏财，财星有力 |
| 食神格 | 月令透食神，食神有力 |
| 伤官格 | 月令透伤官，伤官有力 |
| 正印格 | 月令透正印，印星有力 |
| 偏印格 | 月令透偏印，印星有力 |

### 常见神煞
| 神煞 | 吉凶 | 含义 |
|------|------|------|
| 天乙贵人 | 吉 | 贵人相助，逢凶化吉 |
| 文昌 | 吉 | 利于学业、考试 |
| 驿马 | 中 | 主奔波、变动 |
| 桃花 | 中 | 主人缘、感情 |
| 华盖 | 中 | 主孤独、艺术 |
| 将星 | 吉 | 主权力、领导 |
| 羊刃 | 凶 | 主刚烈、血光 |

### 五行喜忌
- **身强者**：喜财官食伤，忌印比
- **身弱者**：喜印比，忌财官食伤

---

> 💡 **提示**：本次改造主要是内容层面的调整，不涉及核心交互逻辑的修改，预计工作量较小，可在 1-2 天内完成。
