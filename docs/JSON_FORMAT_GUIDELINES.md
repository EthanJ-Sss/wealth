# JSON 格式规范指南

## 概述

本文档规定了八字命理分析系统中 JSON 数据的格式规范，以避免解析失败等问题。

## ⚠️ 禁止使用的字符

以下特殊字符会导致某些 JSON 解析器出错，**必须避免使用**：

| 字符 | 名称 | Unicode | 替代方案 |
|------|------|---------|----------|
| " | 中文左双引号 | U+201C | 使用 「 或 ' |
| " | 中文右双引号 | U+201D | 使用 」 或 ' |
| ' | 中文左单引号 | U+2018 | 使用 ' |
| ' | 中文右单引号 | U+2019 | 使用 ' |
| 　 | 全角空格 | U+3000 | 使用半角空格 |

## ✅ 推荐的替代符号

### 引号替代方案

```
❌ 错误: 属于"墙内开花墙外香"之象
✅ 正确: 属于「墙内开花墙外香」之象
✅ 正确: 属于'墙内开花墙外香'之象
✅ 正确: 属于《墙内开花墙外香》之象
```

### 常用中文标点替代表

| 用途 | 推荐符号 | 示例 |
|------|----------|------|
| 引用术语 | 「」 | 「食神生财」格局 |
| 书名/典籍 | 《》 | 《滴天髓》云 |
| 强调 | 【】 | 【重要提示】 |
| 列举 | 、 | 子、丑、寅、卯 |

## JSON 结构规范

### 1. 文件编码
- 必须使用 **UTF-8** 编码（无 BOM）

### 2. 换行符
- 使用 **LF** (`\n`)，避免 CRLF

### 3. 缩进
- 使用 **2 个空格**，不使用 Tab

### 4. 字符串内容
- 避免使用上述禁止字符
- 如需换行，使用 `\n` 转义
- 如需使用双引号，使用 `\"` 转义

## 验证工具使用

项目提供了 JSON 验证脚本，用于检测和修复问题：

```bash
# 检查单个文件
node scripts/validate-json.cjs check bazi_result.json

# 修复单个文件
node scripts/validate-json.cjs fix love_analysis.json

# 检查所有 JSON 文件
node scripts/validate-json.cjs check-all

# 修复所有 JSON 文件
node scripts/validate-json.cjs fix-all
```

## 开发流程建议

1. **生成数据后**：运行 `check-all` 验证所有文件
2. **提交前**：确保所有 JSON 文件通过验证
3. **遇到解析错误**：使用 `fix` 命令自动修复

## 常见错误示例

### 错误信息解读

```
Expected ',' or '}' after property value in JSON at position 157 (line 3 column 136)
```

**含义**：第 3 行第 136 列附近存在非法字符（通常是中文双引号）

**解决**：
1. 定位到该位置
2. 查找中文双引号 `"` 或 `"`
3. 替换为 `「」` 或删除

## 版本历史

- **v1.0** (2024-12-25): 初始版本，解决中文双引号导致的解析问题

